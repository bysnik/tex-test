name: üìÑ –°–±–æ—Ä–∫–∞ —ç–∫–∑–∞–º–µ–Ω–∞—Ü–∏–æ–Ω–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤ –≤ PDF

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch: # —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

permissions:
  contents: write

jobs:
  build-pdf:
    runs-on: ubuntu-latest
    steps:
      - name: üì• Checkout –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ TeX Live (–ø–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        run: |
          sudo apt-get update
          sudo apt-get install -y texlive-full
          # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
          pdflatex --version

      - name: üîç –ö–æ–º–ø–∏–ª—è—Ü–∏—è –≤—Å–µ—Ö –±–∏–ª–µ—Ç–æ–≤ (.tex ‚Üí .pdf)
        run: |
          # –°–æ–∑–¥–∞—ë–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
          mkdir -p compiled-pdfs

          # –ò—â–µ–º –≤—Å–µ .tex —Ñ–∞–π–ª—ã –≤ –∫–æ—Ä–Ω–µ (–∏—Å–∫–ª—é—á–∞—è —Å–ª—É–∂–µ–±–Ω—ã–µ)
          for texfile in *.tex; do
            # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã –∏ —Å–ª—É–∂–µ–±–Ω—ã–µ
            [[ ! -f "$texfile" ]] && continue
            [[ "$texfile" == "preamble.tex" ]] && continue
            [[ "$texfile" == "main.tex" ]] && continue

            filename="${texfile%.tex}"
            echo "üñ®Ô∏è –ö–æ–º–ø–∏–ª–∏—Ä—É—é: $texfile ‚Üí $filename.pdf"

            # –ö–æ–º–ø–∏–ª–∏—Ä—É–µ–º –≤ 2 –ø—Ä–æ—Ö–æ–¥–∞ –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏
            pdflatex -interaction=nonstopmode -output-directory=compiled-pdfs "$texfile" || true
            pdflatex -interaction=nonstopmode -output-directory=compiled-pdfs "$texfile" || true

            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ PDF —Å–æ–∑–¥–∞–Ω
            if [[ -f "compiled-pdfs/${filename}.pdf" ]]; then
              echo "‚úÖ –£—Å–ø–µ—à–Ω–æ: compiled-pdfs/${filename}.pdf"
            else
              echo "‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ: PDF –Ω–µ —Å–æ–∑–¥–∞–Ω –¥–ª—è $texfile (–≤–æ–∑–º–æ–∂–Ω–æ, –æ—à–∏–±–∫–∞ –≤ –∏—Å—Ö–æ–¥–Ω–∏–∫–µ)"
            fi
          done

          # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
          echo -e "\nüìÅ –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:"
          ls -lh compiled-pdfs/ 2>/dev/null || echo "–ù–µ—Ç —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö PDF"

      - name: üöÄ –ü—É–±–ª–∏–∫–∞—Ü–∏—è PDF –≤ –±—Ä–∞–Ω—á pdf-output
        uses: peaceiris/actions-gh-pages@v4
        if: always() # –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –¥–∞–∂–µ –ø—Ä–∏ —á–∞—Å—Ç–∏—á–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_branch: pdf-output
          publish_dir: ./compiled-pdfs
          keep_files: true
          commit_message: "–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∏–ª–µ—Ç–æ–≤: ${{ github.sha }}"